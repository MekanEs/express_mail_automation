## Задача: Реализовать проверку доступности IMAP аккаунта

### Цель

Добавить функциональность для проверки доступности настроенных почтовых аккаунтов через IMAP. Это включает как серверную логику для самой проверки (включая обновление OAuth токенов), так и клиентский интерфейс для запуска проверки и отображения статуса.

### Предлагаемое решение

#### 1. Бэкенд (сервис `backend`)

* **Новый API Endpoint:**
    * Создать `POST /api/v1/accounts/check-imap`.
    * Принимает идентификатор аккаунта (например, ID или email) в теле запроса.
    * Требует аутентификации пользователя.
* **Логика сервиса (`AccountCheckService` или аналогичный метод):**
    * Безопасно извлекать учетные данные аккаунта (IMAP хост, порт, имя пользователя, пароль/токены).
    * Использовать/Рефакторить логику IMAP подключения из `ProcessService` (см. шаг 3).
    * **Попытка IMAP подключения:**
        * **Аутентификация по паролю:** Попытка прямого подключения.
        * **Аутентификация по токену (OAuth 2.0):**
            1.  Попытка подключения с текущим access токеном.
            2.  **Если аутентификация не удалась (токен истек?):**
                * Проверить наличие refresh токена.
                * Вызвать endpoint провайдера OAuth для получения нового access токена, используя refresh токен.(есть google и yahoo аккаунты)
                * Безопасно обновить сохраненный access токен.
                * Повторить попытку IMAP подключения с новым access токеном.
                3.  Сообщить об ошибке, если обновление не удалось или refresh токен отсутствует.
    * **Ответ:** Возвращать статус: `available` (доступен), `unavailable` (недоступен) (с причиной: `invalid_credentials` - неверные учетные данные, `connection_error` - ошибка подключения, `token_refresh_failed` - ошибка обновления токена), или `error` (общая ошибка).
* **Контроллер:**
    * Обрабатывать запросы к новому endpoint-у.
    * Вызывать логику сервиса.
    * Форматировать и отправлять ответ.

#### 2. Фронтенд (сервис `frontend`)

* **UI Элемент:**
    * Добавить кнопку (например, "Проверить статус") или индикатор статуса в разделе управления аккаунтами.
* **API Вызов:**
    * По действию пользователя (или при загрузке), выполнять аутентифицированный запрос к `POST /api/v1/accounts/check-imap`.
* **Отображение результата:**
    * Показывать состояния успеха/ошибки/загрузки на основе ответа бэкенда.
    * Предоставлять информативные сообщения для различных причин сбоя (например, "Неверные учетные данные", "Не удалось подключиться", "Пожалуйста, переавторизуйтесь").

#### 3. Рефакторинг `ProcessService`

* Проанализировать `backend/src/services/ProcessService/index.ts` и `constants.ts`.
* Вынести основную логику IMAP подключения (аутентификация по паролю и токену) в многоразовый утилитарный класс/функцию (например, `ImapClient` или `ImapUtils`) в `backend/src/utils` или `backend/src/lib`.
* Обновить `ProcessService` для использования новой общей утилиты.
* Новый `AccountCheckService` (из шага 1) также будет использовать эту утилиту.



#### Следующие шаги

1.  Просмотреть код `ProcessService` для определения существующих деталей реализации IMAP.
2.  Определить конкретных OAuth провайдеров (если есть) для реализации корректного процесса обновления токенов.
